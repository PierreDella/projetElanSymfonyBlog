{% extends 'base.html.twig' %}

{% block title %}Fil d'actualité{% endblock %}

{% block body %}
<h2>Mon fil d'actualités</h2>
    <ul>
    {% for subscription in subscriptions %}
        <div class="card-deck">
            {% for recipe in subscription.targetUser.recipes %}
                <div class="card">
                    <img class="card-img-top"  src="{{ asset('uploads/images/' ~ recipe.picture) }}" alt="Card image cap">
                    <div class="card-body">
                        <h5 class="card-title">
                            <a class="card-text" href="{{ path('detailRecipe', {'id':recipe.id}) }}" class="card-title">{{ recipe.name }}</a>
                            <small>{{ recipe.createdAt | date('d/m/Y') }}</small>
                        </h5>
                        {# <small >
                            <a style="padding-bottom:1em;" href='{{ path('user_show', {'id': subscription.targetUser.id}) }}'>{{ subscription.targetUser.pseudo }}</a>   
                        </small> #}
                        <p class="card-text">{{ recipe.description }}</p>
                        <div class="preparationTime">
                            <small class="text-muted">{{ recipe.preparationTime }} minutes</small>
                        </div>
                        <small class="text-muted">{{ recipe.comments | length }} commentaire(s)</small>
                        <a href="{{ path('recipe_like', {'id': recipe.id}) }}" class="btn btn-link js-like">
                            {% if app.user and recipe.isLikedByUser(app.user) %}
                                <i class="fas fa-thumbs-up"></i>
                            {% else %}
                                <i class="far fa-thumbs-up"></i>
                            {% endif %}
                                <span class="js-likes">{{ recipe.likes | length }}</span>
                                <span class="js-label">like<span>
                        </a>
                    </div>
                    <div class="card-footer">
                    <a  href="{{ path('detailRecipe', {'id':recipe.id}) }}" type="button" class="btn btn-outline-secondary">Lire la suite</a>
                    </div>
                </div>
            {% endfor %}    
        </div>      
    {% endfor %}

    
    
    
    
    
    {% endblock %}
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
   



{% block javascripts %}
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
    //     function onClickBtnLike(event){
    //         //
    //         event.preventDefault();
    //         //on prend l'url du lien pour l'avoir dans ajax
    //         const url = this.href; //this sera l'element <a> sur lequel on clique
            
    //         //recher le span avec class js-likes
    //         const spanCount = this.querySelector('span.js-likes');

    //         const icone = this.querySelector('a');
            
    //         //peut etre appelé en POST
    //         //axios permet gestion des promesses qui. La reponse sera ensuite mis dans la fonction
    //         axios.get(url).then(function(response){
    //             // const likes = response.data.likes;
    //             spanCount.textContent = response.data.likes;
    //             //si contient la class 'désabonnement' = aime, alors remplacera par "far"
    //             if(icone.classList.contains('désabonnement')){
    //                 icone.classList.replace('désabonnement', 'abonnement');
                
    //             } else {
    //                 icone.classList.replace('abonnement', 'désabonnement');
    //             }
                   
               
                    
    //         })
    //     }
    //     // selection de tout les <a> avec js-like 
    //     document.querySelectorAll('a.js-like').forEach(function(link){
    //     //quand clique appel de la finction onClick
    //     link.addEventListener('click', onClickBtnLike);
    //     })
    
    </script>
 
{% endblock %}